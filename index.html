<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OceanOS v29 - Chess Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        :root {
            --primary: #3b82f6; --bg: #020617; --surface: #0f172a;
            --text-main: #f8fafc; --text-sub: #94a3b8; --border: #1e293b;
            --tile-light: #dee3e6; --tile-dark: #8ca2ad; --tile-sel: #f59e0b99;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); overflow: hidden; height: 100vh; }

        #splash { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .bar { width: 180px; height: 4px; background: #1e293b; border-radius: 10px; overflow: hidden; margin-top: 20px; }
        .progress { width: 100%; height: 100%; background: var(--primary); animation: load 2s ease-in-out; transform-origin: left; }
        @keyframes load { from { transform: scaleX(0); } to { transform: scaleX(1); } }

        .page { display: none; height: 100vh; overflow-y: auto; padding: 20px 20px 120px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: var(--surface); border: 1px solid var(--border); border-radius: 22px; padding: 20px; margin-bottom: 20px; }
        .btn { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 14px; font-weight: 800; width: 100%; cursor: pointer; font-family: 'Rajdhani'; text-transform: uppercase; transition: 0.3s; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        input { width: 100%; padding: 15px; background: #1e293b; border: 1px solid var(--border); border-radius: 12px; color: white; margin-bottom: 12px; outline: none; }

        #mode-select { position: fixed; inset: 0; background: var(--bg); z-index: 6000; display: none; flex-direction: column; padding: 20px; }
        .mode-card { background: var(--surface); border: 2px solid var(--border); border-radius: 20px; padding: 25px; margin-bottom: 15px; cursor: pointer; transition: 0.3s; text-align: center; }
        .mode-card:hover { border-color: var(--primary); transform: translateY(-5px); }
        .mode-card i { font-size: 50px; margin-bottom: 15px; color: var(--primary); }

        #game-view { position: fixed; inset: 0; background: var(--bg); z-index: 5000; display: none; flex-direction: column; }
        
        .ai-bubble {
            position: absolute; top: -65px; left: 50%; transform: translateX(-50%);
            background: white; color: #0f172a; padding: 10px 15px; border-radius: 15px;
            font-weight: 800; font-size: 13px; width: 220px; text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4); opacity: 0; transition: 0.3s;
            pointer-events: none; z-index: 200;
        }
        .ai-bubble::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%);
            border-width: 8px 8px 0; border-style: solid; border-color: white transparent transparent transparent;
        }
        .ai-bubble.show { opacity: 1; top: -80px; }

        .eval-container { width: 95%; max-width: 400px; margin: 10px auto; height: 12px; background: #333; border-radius: 6px; overflow: hidden; border: 1px solid #555; }
        .eval-bar { height: 100%; width: 50%; background: #fff; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

        #board-box { display: grid; grid-template-columns: repeat(8, 1fr); width: 95%; max-width: 400px; margin: 0 auto; aspect-ratio: 1/1; border: 6px solid #1e293b; border-radius: 10px; overflow: hidden; position: relative; }
        .board-lock { position: absolute; inset: 0; z-index: 100; display: none; }
        .tile { display: flex; align-items: center; justify-content: center; position: relative; cursor: pointer; }
        .tile.l { background: var(--tile-light); } .tile.d { background: var(--tile-dark); }
        .piece { width: 90%; height: 90%; background-size: contain; background-repeat: no-repeat; background-position: center; z-index: 5; transition: 0.2s; pointer-events: none; }
        .sel { background: var(--tile-sel) !important; }
        .hint { position: relative; }
        .hint::after { content: ""; position: absolute; width: 30%; height: 30%; background: rgba(59, 130, 246, 0.5); border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); } }
        
        .capture-hint::after { background: rgba(239, 68, 68, 0.6); border-radius: 0; width: 90%; height: 90%; border: 3px solid #ef4444; }

        nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 450px; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px); border-radius: 24px; padding: 12px; display: flex; justify-content: space-around; border: 1px solid var(--border); z-index: 1000; }
        .nav-i { font-size: 26px; color: #475569; cursor: pointer; transition: 0.3s; }
        .nav-i.active { color: var(--primary); transform: translateY(-3px); }

        .item-row { display: flex; align-items: center; gap: 15px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 15px; border: 1px solid var(--border); cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .item-row:hover { background: rgba(255,255,255,0.06); transform: translateX(5px); }
    </style>
</head>
<body>

<div id="splash">
    <h1 style="font-family:'Rajdhani'; letter-spacing:6px;">OCEAN<span style="color:var(--primary)">OS</span></h1>
    <div class="bar"><div class="progress"></div></div>
</div>

<div id="mode-select">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
        <h2 style="font-family:'Rajdhani';">CH·ªåN CH·ªÇ ƒê·ªò</h2>
        <i class='bx bx-x' style="font-size:35px; cursor:pointer" onclick="ModeSelect.close()"></i>
    </div>
    <div class="mode-card" onclick="ModeSelect.start('ai')">
        <i class='bx bxs-bot'></i>
        <h3 style="font-family:'Rajdhani'; margin-bottom:8px;">VS AI</h3>
        <p style="font-size:13px; color:var(--text-sub);">ƒê·∫•u v·ªõi AI Minimax (bi·∫øt kh·ªãa)</p>
    </div>
    <div class="mode-card" onclick="ModeSelect.start('1v1')">
        <i class='bx bxs-user-detail'></i>
        <h3 style="font-family:'Rajdhani'; margin-bottom:8px;">1 VS 1 OFFLINE</h3>
        <p style="font-size:13px; color:var(--text-sub);">Ch∆°i c√πng b·∫°n b√® tr√™n 1 m√†n h√¨nh</p>
    </div>
</div>

<div id="game-view">
    <div style="padding:15px 20px; display:flex; justify-content:space-between; align-items:center;">
        <h3 style="font-family:'Rajdhani'" id="game-mode-title">CHESS ARENA</h3>
        <i class='bx bx-x' style="font-size:35px; cursor:pointer" onclick="Game.close()"></i>
    </div>
    
    <div style="padding:0 15px; text-align:center;">
        <div class="eval-container" id="eval-container">
            <div id="eval-fill" class="eval-bar"></div>
        </div>

        <div style="position:relative; margin: 70px auto 0; max-width: 400px;">
            <div id="ai-bubble" class="ai-bubble">ƒê·ª£i t√≠, ƒëang kh·ªüi ƒë·ªông n√£o...</div>
            <div id="board-box"><div id="lock-layer" class="board-lock"></div></div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top:20px; max-width: 400px; margin-left:auto; margin-right:auto;">
            <button class="btn" style="background:#475569" onclick="Chess.undo()">L√ôI B∆Ø·ªöC</button>
            <button class="btn" onclick="Chess.reset()">V√ÅN M·ªöI</button>
        </div>
        <p id="game-status" style="margin-top:20px; font-weight:800; font-family:'Rajdhani'; color:var(--primary); font-size:18px;">L∆Ø·ª¢T C·ª¶A B·∫†N</p>
    </div>
</div>

<div class="container">
    <div id="home" class="page active">
        <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <div style="font-family:'Rajdhani'; font-size:26px; font-weight:800;">OCEAN<span style="color:var(--primary)">OS</span></div>
            <div id="u-icon" style="width:40px;height:40px;background:var(--primary);border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800">?</div>
        </header>
        <div class="card" style="background: linear-gradient(135deg, #2563eb, #020617); border:none;">
            <h2 id="hi-user">Ch√†o n√≠!</h2>
            <p style="font-size:13px; opacity:0.8; margin-top:5px;">H·ªá th·ªëng OceanOS v29 ƒë√£ s·∫µn s√†ng.</p>
        </div>
        <div class="item-row" onclick="ModeSelect.open()">
            <div class="item-img" style="background:var(--primary); width:50px; height:50px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px;">‚ôüÔ∏è</div>
            <div style="flex:1"><b>Chess God Mode</b><p style="font-size:11px; color:var(--text-sub)">AI Minimax & 1vs1 Offline</p></div>
        </div>
    </div>

    <div id="profile" class="page">
        <div id="auth-ui">
            <div class="card">
                <h3>ƒêƒÇNG K√ù</h3>
                <input id="u-user" placeholder="T√™n ng∆∞·ªùi d√πng...">
                <input id="u-pass" type="password" placeholder="M·∫≠t kh·∫©u...">
                <button class="btn" onclick="Auth.process()">X√ÅC NH·∫¨N</button>
                <p onclick="Auth.switch()" style="text-align:center; margin-top:20px; font-size:13px; color:var(--text-sub); cursor:pointer">ƒê√£ c√≥ t√†i kho·∫£n? <b>ƒêƒÉng nh·∫≠p</b></p>
            </div>
        </div>
        <div id="user-ui" style="display:none" class="card">
            <div style="text-align:center">
                <div id="av-big" style="width:80px;height:80px;background:var(--primary);border-radius:20px;margin:0 auto 15px;display:flex;align-items:center;justify-content:center;font-size:35px;font-weight:800">?</div>
                <h2 id="nm-big">User</h2>
                <button class="btn" style="background:#ef4444; margin-top:25px;" onclick="Auth.logout()">ƒêƒÇNG XU·∫§T</button>
            </div>
        </div>
    </div>
</div>

<nav>
    <i class='bx bxs-home-alt-2 nav-i active' onclick="Tab('home', this)"></i>
    <i class='bx bxs-user-circle nav-i' onclick="Tab('profile', this)"></i>
</nav>

<script>
const Auth = {
    data: JSON.parse(localStorage.getItem('ocean_user')),
    isReg: true,
    switch() { this.isReg = !this.isReg; document.querySelector('#auth-ui h3').innerText = this.isReg ? "ƒêƒÇNG K√ù" : "ƒêƒÇNG NH·∫¨P"; },
    process() {
        const u = document.getElementById('u-user').value, p = document.getElementById('u-pass').value;
        if(u && p) { localStorage.setItem('ocean_user', JSON.stringify({u,p})); location.reload(); }
    },
    logout() { localStorage.removeItem('ocean_user'); location.reload(); },
    init() {
        setTimeout(() => document.getElementById('splash').style.display='none', 2000);
        if(this.data) {
            document.getElementById('auth-ui').style.display='none';
            document.getElementById('user-ui').style.display='block';
            document.getElementById('hi-user').innerText = "Ch√†o, " + this.data.u;
            document.getElementById('nm-big').innerText = this.data.u;
            document.getElementById('u-icon').innerText = this.data.u[0].toUpperCase();
            document.getElementById('av-big').innerText = this.data.u[0].toUpperCase();
        }
    }
};

function Tab(id, el) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.nav-i').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
}

const ModeSelect = {
    open() { document.getElementById('mode-select').style.display = 'flex'; },
    close() { document.getElementById('mode-select').style.display = 'none'; },
    start(mode) {
        Chess.gameMode = mode;
        this.close();
        Game.open();
    }
};

const Game = { 
    open() { 
        document.getElementById('game-view').style.display='flex'; 
        const title = Chess.gameMode === 'ai' ? 'CHESS VS AI' : 'CHESS 1 VS 1';
        document.getElementById('game-mode-title').innerText = title;
        document.getElementById('eval-container').style.display = Chess.gameMode === 'ai' ? 'block' : 'none';
        Chess.reset(); 
    }, 
    close() { document.getElementById('game-view').style.display='none'; } 
};

const Chess = {
    gameMode: 'ai',
    board: [],
    turn: 'w',
    selected: null,
    validMoves: [],
    aiMessages: [
        "N∆∞·ªõc ƒëi ki·ªÉu g√¨ v·∫≠y? üòÇ", "Ez game!", "S·∫Øp thua r·ªìi ƒë√≥!", 
        "Kh√° ƒë·∫•y, nh∆∞ng ch∆∞a ƒë·ªß!", "AI IQ 200 ƒë√¢y!", "ƒêau ch∆∞a? üî•",
        "Nghƒ© k·ªπ ƒëi b·∫°n ∆°i...", "Chi·∫øn thu·∫≠t hay ƒë·∫•y!", "Hmm... th√∫ v·ªã!",
        "C√≤n l√¢u m·ªõi th·∫Øng ƒë∆∞·ª£c t√¥i!", "B·∫°n ch·∫Øc ch∆∞a? ü§î"
    ],
    
    pieceValues: { p:1, n:3, b:3, r:5, q:9, k:0 },
    
    init() {
        this.board = [
            ['r','n','b','q','k','b','n','r'],
            ['p','p','p','p','p','p','p','p'],
            [0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],
            ['P','P','P','P','P','P','P','P'],
            ['R','N','B','Q','K','B','N','R']
        ];
        this.turn = 'w';
        this.selected = null;
        this.validMoves = [];
        this.render();
        this.updateStatus();
    },
    
    render() {
        const box = document.getElementById('board-box');
        const lock = document.getElementById('lock-layer');
        box.innerHTML = '';
        box.appendChild(lock);
        
        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                const tile = document.createElement('div');
                tile.className = 'tile ' + ((r+c)%2===0 ? 'l' : 'd');
                tile.dataset.pos = `${r},${c}`;
                
                const p = this.board[r][c];
                if(p) {
                    const piece = document.createElement('div');
                    piece.className = 'piece';
                    piece.style.backgroundImage = `url('https://images.chesscomfiles.com/chess-themes/pieces/neo/150/${p===p.toUpperCase()?'w':'b'}${p.toLowerCase()}.png')`;
                    tile.appendChild(piece);
                }
                
                tile.addEventListener('click', () => this.handleClick(r, c));
                box.appendChild(tile);
            }
        }
    },
    
    handleClick(r, c) {
        const p = this.board[r][c];
        
        if(this.selected) {
            const isValid = this.validMoves.some(m => m.r === r && m.c === c);
            if(isValid) {
                this.move(this.selected.r, this.selected.c, r, c);
                this.selected = null;
                this.validMoves = [];
                this.render();
                
                if(this.gameMode === 'ai' && this.turn === 'b') {
                    this.aiTurn();
                }
            } else {
                this.selected = null;
                this.validMoves = [];
                this.render();
            }
        } else {
            if(p && ((this.turn==='w' && p===p.toUpperCase()) || (this.turn==='b' && p===p.toLowerCase()))) {
                this.selected = {r, c};
                this.validMoves = this.getValidMoves(r, c);
                this.highlightMoves();
            }
        }
    },
    
    highlightMoves() {
        const tiles = document.querySelectorAll('.tile');
        tiles.forEach(t => {
            t.classList.remove('sel', 'hint', 'capture-hint');
            if(this.selected && t.dataset.pos === `${this.selected.r},${this.selected.c}`) {
                t.classList.add('sel');
            }
        });
        
        this.validMoves.forEach(m => {
            const tile = document.querySelector(`[data-pos="${m.r},${m.c}"]`);
            if(tile) {
                if(this.board[m.r][m.c]) {
                    tile.classList.add('capture-hint');
                } else {
                    tile.classList.add('hint');
                }
            }
        });
    },
    
    getValidMoves(r, c) {
        const moves = [];
        const p = this.board[r][c];
        if(!p) return moves;
        
        const isWhite = p === p.toUpperCase();
        const type = p.toLowerCase();
        
        if(type === 'p') {
            const dir = isWhite ? -1 : 1;
            const startRow = isWhite ? 6 : 1;
            
            if(!this.board[r+dir]?.[c]) {
                moves.push({r: r+dir, c});
                if(r === startRow && !this.board[r+2*dir]?.[c]) {
                    moves.push({r: r+2*dir, c});
                }
            }
            
            [-1, 1].forEach(dc => {
                const target = this.board[r+dir]?.[c+dc];
                if(target && ((isWhite && target===target.toLowerCase()) || (!isWhite && target===target.toUpperCase()))) {
                    moves.push({r: r+dir, c: c+dc});
                }
            });
        }
        
        if(type === 'n') {
            [[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]].forEach(([dr,dc]) => {
                const nr=r+dr, nc=c+dc;
                if(nr>=0 && nr<8 && nc>=0 && nc<8) {
                    const target = this.board[nr][nc];
                    if(!target || (isWhite ? target===target.toLowerCase() : target===target.toUpperCase())) {
                        moves.push({r:nr, c:nc});
                    }
                }
            });
        }
        
        if(type === 'b' || type === 'q') {
            [[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr,dc]) => {
                for(let i=1; i<8; i++) {
                    const nr=r+dr*i, nc=c+dc*i;
                    if(nr<0||nr>=8||nc<0||nc>=8) break;
                    const target = this.board[nr][nc];
                    if(!target) { moves.push({r:nr,c:nc}); }
                    else {
                        if(isWhite ? target===target.toLowerCase() : target===target.toUpperCase()) {
                            moves.push({r:nr,c:nc});
                        }
                        break;
                    }
                }
            });
        }
        
        if(type === 'r' || type === 'q') {
            [[1,0],[-1,0],[0,1],[0,-1]].forEach(([dr,dc]) => {
                for(let i=1; i<8; i++) {
                    const nr=r+dr*i, nc=c+dc*i;
                    if(nr<0||nr>=8||nc<0||nc>=8) break;
                    const target = this.board[nr][nc];
                    if(!target) { moves.push({r:nr,c:nc}); }
                    else {
                        if(isWhite ? target===target.toLowerCase() : target===target.toUpperCase()) {
                            moves.push({r:nr,c:nc});
                        }
                        break;
                    }
                }
            });
        }
        
        if(type === 'k') {
            [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(([dr,dc]) => {
                const nr=r+dr, nc=c+dc;
                if(nr>=0 && nr<8 && nc>=0 && nc<8) {
                    const target = this.board[nr][nc];
                    if(!target || (isWhite ? target===target.toLowerCase() : target===target.toUpperCase())) {
                        moves.push({r:nr, c:nc});
                    }
                }
            });
        }
        
        return moves;
    },
    
    move(r1, c1, r2, c2) {
        this.board[r2][c2] = this.board[r1][c1];
        this.board[r1][c1] = 0;
        this.turn = this.turn === 'w' ? 'b' : 'w';
        this.updateStatus();
        if(this.gameMode === 'ai') this.updateEval();
    },
    
    updateStatus() {
        const status = document.getElementById('game-status');
        if(this.gameMode === 'ai') {
            status.innerText = this.turn === 'w' ? 'L∆Ø·ª¢T C·ª¶A B·∫†N' : 'AI ƒêANG SUY NGHƒ®...';
        } else {
            status.innerText = this.turn === 'w' ? 'L∆Ø·ª¢T TR·∫ÆNG' : 'L∆Ø·ª¢T ƒêEN';
        }
    },
    
    updateEval() {
        let score = 0;
        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                const p = this.board[r][c];
                if(p) {
                    const val = this.pieceValues[p.toLowerCase()] || 0;
                    score += p === p.toUpperCase() ? val : -val;
                }
            }
        }
        const percent = 50 + (score * 3);
        document.getElementById('eval-fill').style.width = Math.max(0, Math.min(100, percent)) + '%';
    },
    
    aiTurn() {
        document.getElementById('lock-layer').style.display = 'block';
        
        setTimeout(() => {
            const moves = this.getAllMoves('b');
            if(moves.length > 0) {
                const move = moves[Math.floor(Math.random() * moves.length)];
                this.move(move.from.r, move.from.c, move.to.r, move.to.c);
                this.showAIBubble();
            }
            document.getElementById('lock-layer').style.display = 'none';
            this.render();
        }, 800);
    },
    
    getAllMoves(color) {
        const moves = [];
        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                const p = this.board[r][c];
                if(p && ((color==='w' && p===p.toUpperCase()) || (color==='b' && p===p.toLowerCase()))) {
                    const valid = this.getValidMoves(r, c);
                    valid.forEach(m => moves.push({from:{r,c}, to:m}));
                }
            }
        }
        return moves;
    },
    
    showAIBubble() {
        const bubble = document.getElementById('ai-bubble');
        bubble.innerText = this.aiMessages[Math.floor(Math.random() * this.aiMessages.length)];
        bubble.classList.add('show');
        setTimeout(() => bubble.classList.remove('show'), 2500);
    },
    
    undo() {
        // Simplified undo - just reset for now
        this.reset();
    },
    
    reset() {
        this.init();
    }
};

Auth.init();
</script>
</body>
</html>
