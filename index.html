<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Chess Lite</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  background:#111;
  color:#fff;
  font-family:system-ui;
  text-align:center;
}
#board{
  width:360px;
  margin:20px auto;
  display:grid;
  grid-template-columns:repeat(8,1fr);
  border:4px solid #444;
}
.cell{
  width:45px;
  height:45px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  cursor:pointer;
}
.light{background:#f0d9b5}
.dark{background:#b58863}
.selected{outline:3px solid red}
#status{margin:10px;font-weight:bold}
button,select{
  padding:8px;
  margin:5px;
  border-radius:6px;
  border:none;
}
</style>
</head>

<body>

<h2>â™Ÿï¸ Chess Lite</h2>

<div>
  Äá»™ khÃ³:
  <select id="level">
    <option value="easy">Dá»…</option>
    <option value="medium">Trung</option>
    <option value="hard">KhÃ³</option>
  </select>
  <button onclick="reset()">ğŸ”„ ChÆ¡i láº¡i</button>
</div>

<div id="status">LÆ°á»£t cá»§a báº¡n (Tráº¯ng)</div>
<div id="board"></div>

<script>
const boardDiv=document.getElementById("board");
const statusDiv=document.getElementById("status");

const P={
 r:"â™œ",n:"â™",b:"â™",q:"â™›",k:"â™š",p:"â™Ÿ",
 R:"â™–",N:"â™˜",B:"â™—",Q:"â™•",K:"â™”",P:"â™™"
};

let board,selected=null,turn="white",gameOver=false;

function reset(){
  board=[
   "rnbqkbnr",
   "pppppppp",
   "........",
   "........",
   "........",
   "........",
   "PPPPPPPP",
   "RNBQKBNR"
  ];
  selected=null;
  turn="white";
  gameOver=false;
  statusDiv.textContent="LÆ°á»£t cá»§a báº¡n (Tráº¯ng)";
  draw();
}

function draw(){
  boardDiv.innerHTML="";
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let d=document.createElement("div");
      d.className="cell "+((r+c)%2?"dark":"light");
      if(selected && selected[0]==r && selected[1]==c)
        d.classList.add("selected");
      let p=board[r][c];
      d.textContent=p!="."?P[p]:"";
      d.onclick=()=>click(r,c);
      boardDiv.appendChild(d);
    }
  }
}

function click(r,c){
  if(gameOver||turn!="white")return;
  let p=board[r][c];
  if(selected){
    if(canMove(selected[0],selected[1],r,c,true)){
      move(selected[0],selected[1],r,c);
      selected=null;
      if(checkWin())return;
      setTimeout(aiMove,400);
    }else selected=null;
  }else if(p>="A"&&p<="Z"){
    selected=[r,c];
  }
  draw();
}

function move(r1,c1,r2,c2){
  board[r2]=set(board[r2],c2,board[r1][c1]);
  board[r1]=set(board[r1],c1,".");
}

function canMove(r1,c1,r2,c2,white){
  let p=board[r1][c1];
  let t=board[r2][c2];
  if(white && t>="A"&&t<="Z")return false;
  if(!white && t>="a"&&t<="z")return false;

  let dr=r2-r1, dc=c2-c1;

  if(p.toLowerCase()=="p"){
    let dir=white?-1:1;
    if(dc==0 && dr==dir && t==".")return true;
    if(Math.abs(dc)==1 && dr==dir && t!=".")return true;
  }
  if(p.toLowerCase()=="r" && (dr==0||dc==0))return clear(r1,c1,r2,c2);
  if(p.toLowerCase()=="b" && Math.abs(dr)==Math.abs(dc))return clear(r1,c1,r2,c2);
  if(p.toLowerCase()=="n" && (Math.abs(dr)==2&&Math.abs(dc)==1||Math.abs(dr)==1&&Math.abs(dc)==2))return true;
  if(p.toLowerCase()=="q" && (dr==0||dc==0||Math.abs(dr)==Math.abs(dc)))return clear(r1,c1,r2,c2);
  if(p.toLowerCase()=="k" && Math.abs(dr)<=1&&Math.abs(dc)<=1)return true;

  return false;
}

function clear(r1,c1,r2,c2){
  let sr=Math.sign(r2-r1), sc=Math.sign(c2-c1);
  r1+=sr; c1+=sc;
  while(r1!=r2||c1!=c2){
    if(board[r1][c1]!=".")return false;
    r1+=sr; c1+=sc;
  }
  return true;
}

function aiMove(){
  if(gameOver)return;
  let moves=[];
  for(let r=0;r<8;r++)for(let c=0;c<8;c++){
    if(board[r][c]>="a"&&board[r][c]<="z"){
      for(let r2=0;r2<8;r2++)for(let c2=0;c2<8;c2++){
        if(canMove(r,c,r2,c2,false))
          moves.push([r,c,r2,c2]);
      }
    }
  }
  if(moves.length==0)return;
  let m=moves[Math.floor(Math.random()*moves.length)];
  move(...m);
  if(checkWin())return;
  turn="white";
  statusDiv.textContent="LÆ°á»£t cá»§a báº¡n (Tráº¯ng)";
  draw();
}

function checkWin(){
  let flat=board.join("");
  if(!flat.includes("k")){
    statusDiv.textContent="ğŸ‰ Báº¡n THáº®NG!";
    gameOver=true; return true;
  }
  if(!flat.includes("K")){
    statusDiv.textContent="ğŸ’€ Báº¡n THUA!";
    gameOver=true; return true;
  }
  turn=turn=="white"?"black":"white";
  statusDiv.textContent=turn=="white"?"LÆ°á»£t cá»§a báº¡n":"MÃ¡y Ä‘ang nghÄ©...";
  return false;
}

function set(s,i,ch){
  return s.substring(0,i)+ch+s.substring(i+1);
}

reset();
</script>

</body>
</html>